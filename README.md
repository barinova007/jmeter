# jmeter
```
JMeter предоставляет очень широкие возможности по созданию сценариев, я рассмотрю только необходимый минимум для тестирования Flex-приложений.

Как правило, пользователи работают с приложением в несколько шагов.
Например, это может быть вход на первую страницу, выбор товара, добавление в корзину и оформление заказа. 
Каждый такой сценарий в JMeter соответствует группе запросов - Thread Group в плане тестирования (Test Plan). 
В каждой группе могут быть различные элементы - параметры выполнения, запросы, представление результатов выполнения.
На текущий момент у нас есть только запросы, собранные с помощью HTTP Proxy Server. 
Создадим на их основе сценарий тестирования (все добавление элементов в JMeter'ом преимущественно осуществляется
с помощью контекстного меню дерева элементов, поэтому ищите команды в них).

Test Plan → Add → Threads (Users) → Thread Group - создаем новую группу последовательных действий.
Thread Group → Add → Config Element → HTTP Cookie Manager - добавляем элемент управления cookies. 
Это необходимо, чтобы все запросы между собой были связаны в одну сессию. Иначе сервер откажется обрабатывать второй и последующие запросы. 
По одному перетаскиваем сохраненные запросу в Thread Group и добавляем их как детей (Add as Child). Вместо перетаскивания можно сделать Cut&Paste;
Thread Group → Add → View result tree добавляем слушателя запросов, который просто отображает запрос-ответ.
Сценарий запускается через главное меню Run → Start. В соотвествующих элементах (View Results Tree) вы увидите посланные запросы и ответы на них.
Запросы будут отосланы один раз в одном потоке. Количество потоков и циклов задается в настройках Thread Groups:

Number of threads (users) - сколько одновременных потоков обращается к серверу (количество работающих пользователей);
Ramp-Up Period: время, в течении которого будут запущены все потоки. Например, вы делаете тест в 20 потоков и ставите ramp-up period в 60 секунд. 
Тогда каждый новый поток будет стартовать каждые три секунды.
Loop count: сколько раз будет выполнен каждый сценарий каждым пользователем.
Например, вы ставите 10 потоков и 5 циклов, тогда каждый запрос в сценарии будет выполнен 50 раз. 
Как вы помните, в при снятие данных мы изрядно помучились с DSid.
При тестировании нужно указать правильное значение с тем, чтобы каждый пользователь (поток Thread Group) имел свой уникальный номер клиента. 
Для этого добавим пост-обработчик сообщения XPath Extractor к ping-запросу как показано на рисунке. 
Этот элемент извлекает из полученного сообщения нужную нам строку и сохраняется ее в пользовательской переменной. 
После этого при отправки запросов, они будут иметь правильный DSid. Переменные живут в рамках одного потока Thread Group (одного пользователя). 
То есть если мы запустим 5 параллельных потоков, в каждом из них DSid будет иметь свое значение. 
Таким образом, теперь можно запустить много-много потоков и сделать настоящее нагрузочное тестирование.

amf-jmeter-xpath-extractor.png

Предположим, что вы хотите смоделировать ситуацию долгой работы пользователя с вашей системой. 
То есть пользователь зашел и начал делать какие-то операции. 
Вам интересно, будет происходит утечка памяти или что-то подобное. 
Тогда можно все запросы связанные с иницализаций (например, ping-запрос и запрос на аутентификацию) поместить в логический контроллер Once Only Controller.
Элементы в нем будут выполнены в потоке только один раз (сами поток будет выполнен Loop count раз). 
Можно пойти по другому пути и объединить логику работы в Loop Controller.
Но мне данный подход кажется противоестественным для решения данной задачи.
```
